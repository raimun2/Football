library(jsonlite)
library(plyr)
## paso 1: seleccionar torneo 2019
#setwd("D:/Users/Italo/Documents/Italo Felipe/Proyectos/Futbol Analitycs/2020/ANFP/Data/Torneos Juveniles/Mundial U20/Polonia 2019/Partidos")
setwd("C:/Users/monse/Dropbox/soccer analytics/data/Primera Division 2018")
## genero una lista de todos los archivos en esa carpeta
partidos <- list.files("./Partidos")
## inicializo dataframe de jugadores
data_partidos <- NULL
## recorrer todos los archivos para leerlos
npartidos <- length(partidos)
print(npartidos)
for (i in 1:npartidos){
## paso 2: cargar archivos
## leo el partido i
partidoi <- read_json(paste0(getwd(),"/Partidos/",partidos[i]))
data_partidolocal <- NULL
data_partidovisita <- NULL
## paso 3: ordenar los datos
## extraigo variables relevantes
matchinfo <- partidoi$matchInfo
livedata <- partidoi$liveData
fechapartido <- matchinfo$date
partidoj <- matchinfo$description
contestant <- matchinfo$contestant
contestant1 <- contestant[[1]]$name
contestant2 <- contestant[[2]]$name
lineup <- livedata$lineUp
lineup1 <- lineup[[1]]
lineup2 <- lineup[[2]]
statslocal <- lineup1$stat
statsvisita <- lineup2$stat
### extraigo jugadores
jugadoreslocal <- lineup1$player
jugadoresvisita <- lineup2$player
njugadoresl <- length(jugadoreslocal)
njugadoresv <- length(jugadoresvisita)
###extraer partido, nombre equipo, fecha
for(s in 1:(njugadoresl)){
#identifico jugador s
jugadors <- jugadoreslocal[[s]]
if(!is.null(jugadors$stat)){
stats <- as.data.frame(matrix(unlist(jugadors$stat), nrow = 2))
colnames(stats) <- lapply(stats[1,], as.character)
stats <- as.data.frame(stats[2,])
### jugadors$stat <- NULL
### junto variables relevantes de cada jugador
stats$fecha <- matchinfo$date
stats$idequipo <- lineup1$contestantId
stats$equipo <- contestant1
stats$idjugador <- jugadors$playerId
stats$position <- jugadors$position
## junto todo
data_partidolocal <- rbind.fill(data_partidolocal,stats)
}
}
for(s in 1:(njugadoresv)){
#identifico jugador s
jugadors <- jugadoresvisita[[s]]
if(!is.null(jugadors$stat)){
stats <- as.data.frame(matrix(unlist(jugadors$stat), nrow = 2))
colnames(stats) <- lapply(stats[1,], as.character)
stats <- as.data.frame(stats[2,])
### jugadors$stat <- NULL
### junto variables relevantes de cada jugador
stats$fecha <- matchinfo$date
stats$idequipo <- lineup2$contestantId
stats$equipo <- contestant2
stats$idjugador <- jugadors$playerId
stats$position <- jugadors$position
## junto todo
data_partidovisita <- rbind.fill(data_partidovisita,stats)
}
}
data_partidolocal$local <- TRUE
data_partidovisita$local <- FALSE
data_partidolocal$id_partido <- matchinfo$id
data_partidovisita$id_partido <- matchinfo$id
#extraigo estadisticas de los equipos
data_partidos <- rbind.fill(data_partidos, data_partidolocal)
data_partidos <- rbind.fill(data_partidos, data_partidovisita)
}
save.image("data_procesada.RData")
View(data_partidos)
